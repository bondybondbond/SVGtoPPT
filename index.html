<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG to PowerPoint Converter</title>
    <!-- Both CDN sources for better availability -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.bundle.js" integrity="sha512-X9+SPQovcsiOYthV3YFMt7R/Z5UpF4cCHv2tb3pYJS9CnMIRxOGzgZNyKZCdNJTFkfnzBYeN9QiKnZf1OYCXJg==" crossorigin="anonymous"></script>
    <script>
        // Fallback script loading if the primary CDN fails
        window.addEventListener('error', function(e) {
            if (e.target.src && e.target.src.includes('pptxgenjs')) {
                console.log('Primary CDN failed, loading from backup...');
                var script = document.createElement('script');
                script.src = 'https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.bundle.js';
                document.head.appendChild(script);
            }
        }, true);
    </script>
    <style>
        :root {
            --primary: #0066cc;
            --primary-dark: #0055aa;
            --light-bg: #f8f8f8;
            --border: #ddd;
            --text: #333;
            --success: #2e7d32;
            --success-bg: #e6f7e6;
            --error: #c62828;
            --error-bg: #ffebee;
            --warning: #f57c00;
            --warning-bg: #fff8e1;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            color: var(--text);
            background-color: #f5f5f5;
        }
        
        h1 {
            color: var(--primary);
            text-align: center;
            margin: 10px 0;
            font-size: 24px;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .tab-container {
            margin-top: 15px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            margin-right: 5px;
            font-weight: bold;
            color: var(--text);
            transition: background-color 0.2s;
        }
        
        .tab-button.active {
            background-color: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 10px;
            background-color: var(--light-bg);
            border-radius: 0 0 4px 4px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 600px) {
            .option-grid {
                grid-template-columns: 1fr;
            }
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            resize: vertical;
            font-family: monospace;
            margin-bottom: 10px;
        }
        
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: white;
        }
        
        input[type="number"] {
            width: 80px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-right: 5px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--primary-dark);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .preview-container {
            margin: 15px 0;
            border: 1px solid var(--border);
            padding: 10px;
            background-color: white;
            border-radius: 4px;
            overflow: auto;
            min-height: 150px;
            max-height: 300px;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .success { background-color: var(--success-bg); color: var(--success); }
        .error { background-color: var(--error-bg); color: var(--error); }
        .warning { background-color: var(--warning-bg); color: var(--warning); }
        
        .sample-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .sample-button {
            background-color: #f0f0f0;
            color: var(--text);
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            min-width: 100px;
            text-align: center;
            font-size: 13px;
        }
        
        .sample-button:hover {
            background-color: #e0e0e0;
        }
        
        .resolution-radio {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .resolution-option {
            flex: 1;
            min-width: 130px;
        }
        
        .resolution-option input[type="radio"] {
            display: none;
        }
        
        .resolution-option label {
            display: block;
            padding: 8px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }
        
        .resolution-option input[type="radio"]:checked + label {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider {
            width: 100%;
            margin-top: 5px;
        }
        
        .slider-value {
            font-weight: bold;
            display: inline-block;
            min-width: 40px;
            text-align: right;
        }
        
        .preview-frame {
            border: 1px dashed #ccc;
            margin: 0 auto;
            position: relative;
        }
        
        .convert-button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-top: 15px;
        }
        
        .fit-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .fit-option {
            flex: 1;
            min-width: 80px;
        }
        
        .fit-option input[type="radio"] {
            display: none;
        }
        
        .fit-option label {
            display: block;
            padding: 8px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }
        
        .fit-option input[type="radio"]:checked + label {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .library-error {
            background-color: var(--error-bg);
            color: var(--error);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .loading-indicator {
            text-align: center;
            color: var(--primary);
            margin: 20px 0;
            display: none;
        }
        
        .download-button {
            background-color: #4caf50;
            margin-top: 10px;
        }
        
        .download-button:hover {
            background-color: #3e8e41;
        }
        
        .font-settings {
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: white;
        }
        
        .font-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .font-row:last-child {
            margin-bottom: 0;
        }
        
        .font-label {
            width: 120px;
            min-width: 120px;
            font-weight: bold;
        }
        
        .font-controls {
            display: flex;
            flex: 1;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .size-input {
            width: 60px;
            text-align: center;
        }
        
        .auto-size-button {
            background-color: #f0f0f0;
            color: var(--text);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .auto-size-button:hover {
            background-color: #e0e0e0;
        }
        
        .auto-size-button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <h1>SVG to PowerPoint Converter</h1>
    
    <div class="container">
        <div id="library-error" class="library-error" style="display: none;">
            PowerPoint library couldn't be loaded. Please try:
            <ol>
                <li>Refreshing the page</li>
                <li>Using a different browser</li>
                <li>Checking your internet connection</li>
            </ol>
        </div>
        
        <div id="loading-indicator" class="loading-indicator">
            Loading PowerPoint library... Please wait.
        </div>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="input">1. Select SVG</button>
                <button class="tab-button" data-tab="preview">2. Preview & Convert</button>
            </div>
            
            <div class="tab-content active" id="input-tab">
                <div class="sample-buttons">
                    <button class="sample-button" id="basicShapes">Basic Shapes</button>
                    <button class="sample-button" id="simpleChart">Bar Chart</button>
                    <button class="sample-button" id="flowchart">Flowchart</button>
                    <button class="sample-button" id="comparisonChart">Comparison Chart</button>
                </div>
                
                <div>
                    <label for="svgInput">SVG Code:</label>
                    <textarea id="svgInput" placeholder="<svg>...</svg>"></textarea>
                </div>
                
                <div class="resolution-radio">
                    <div class="resolution-option">
                        <input type="radio" id="resolution-16-9" name="resolution" value="LAYOUT_16x9" checked>
                        <label for="resolution-16-9">16:9 (1920×1080)</label>
                    </div>
                    <div class="resolution-option">
                        <input type="radio" id="resolution-4-3" name="resolution" value="LAYOUT_4x3">
                        <label for="resolution-4-3">4:3 (1024×768)</label>
                    </div>
                    <div class="resolution-option">
                        <input type="radio" id="resolution-16-10" name="resolution" value="LAYOUT_16x10">
                        <label for="resolution-16-10">16:10 (1920×1200)</label>
                    </div>
                </div>
                
                <button id="nextButton" class="convert-button">Continue to Preview</button>
            </div>
            
            <div class="tab-content" id="preview-tab">
                <div class="option-grid">
                    <div class="slider-container">
                        <label for="margin-slider">Slide Margin: <span id="margin-value" class="slider-value">0%</span></label>
                        <input type="range" id="margin-slider" class="slider" min="0" max="20" value="0">
                    </div>
                    
                    <div>
                        <label>Fit Method:</label>
                        <div class="fit-options">
                            <div class="fit-option">
                                <input type="radio" id="fit-option" name="fit-method" value="fit" checked>
                                <label for="fit-option">Fit</label>
                            </div>
                            <div class="fit-option">
                                <input type="radio" id="fill-option" name="fit-method" value="fill">
                                <label for="fill-option">Fill</label>
                            </div>
                            <div class="fit-option">
                                <input type="radio" id="stretch-option" name="fit-method" value="stretch">
                                <label for="stretch-option">Stretch</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="font-settings">
                    <h3 style="margin-top: 0; margin-bottom: 10px;">Font Settings</h3>
                    
                    <div class="font-row">
                        <div class="font-label">Font Family:</div>
                        <div class="font-controls">
                            <select id="font-family-select" style="min-width: 200px;">
                                <option value="Arial">Arial</option>
                                <option value="Calibri">Calibri</option>
                                <option value="Segoe UI">Segoe UI</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Tahoma">Tahoma</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Georgia">Georgia</option>
                            </select>
                            <button id="detect-fonts-button" style="font-size: 12px; padding: 8px;">Detect Fonts</button>
                        </div>
                    </div>
                    
                    <div class="font-row">
                        <div class="font-label">Title Text:</div>
                        <div class="font-controls">
                            <input type="number" id="title-size" class="size-input" value="24" min="8" max="72">
                            <span>px</span>
                        </div>
                    </div>
                    
                    <div class="font-row">
                        <div class="font-label">Sub Header:</div>
                        <div class="font-controls">
                            <input type="number" id="subheader-size" class="size-input" value="18" min="8" max="72">
                            <span>px</span>
                        </div>
                    </div>
                    
                    <div class="font-row">
                        <div class="font-label">Normal Text:</div>
                        <div class="font-controls">
                            <input type="number" id="normal-size" class="size-input" value="14" min="8" max="72">
                            <span>px</span>
                        </div>
                    </div>
                    
                    <div class="font-row">
                        <div class="font-label">Footnote:</div>
                        <div class="font-controls">
                            <input type="number" id="footnote-size" class="size-input" value="12" min="8" max="72">
                            <span>px</span>
                        </div>
                    </div>
                    
                    <button id="auto-size-button" class="convert-button" style="margin-top: 10px; background-color: #f0f0f0; color: #333;">Auto-Size Text</button>
                </div>
                
                <h3>Preview</h3>
                <div id="preview-container" class="preview-container">
                    <div id="preview-frame" class="preview-frame">
                        <div id="svgPreview" style="display: flex; justify-content: center;"></div>
                    </div>
                </div>
                
                <button id="convertButton" class="convert-button">Convert to PowerPoint</button>
                <button id="downloadSvgButton" class="convert-button download-button" style="display: none;">Download as SVG</button>
                <div id="statusMessage" class="status" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Show loading indicator
            document.getElementById('loading-indicator').style.display = 'block';
            
            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Deactivate all tabs
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Activate the selected tab
                    this.classList.add('active');
                    document.getElementById(tabId + '-tab').classList.add('active');
                    
                    // Update preview when switching to preview tab
                    if (tabId === 'preview') {
                        updatePreview();
                    }
                });
            });
            
            // Next button functionality
            document.getElementById('nextButton').addEventListener('click', function() {
                document.querySelector('[data-tab="preview"]').click();
            });
            
            // Elements
            const svgInput = document.getElementById('svgInput');
            const convertButton = document.getElementById('convertButton');
            const downloadSvgButton = document.getElementById('downloadSvgButton');
            const statusMessage = document.getElementById('statusMessage');
            const svgPreview = document.getElementById('svgPreview');
            const previewFrame = document.getElementById('preview-frame');
            const libraryError = document.getElementById('library-error');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            // Font controls
            const fontFamilySelect = document.getElementById('font-family-select');
            const detectFontsButton = document.getElementById('detect-fonts-button');
            const titleSizeInput = document.getElementById('title-size');
            const subheaderSizeInput = document.getElementById('subheader-size');
            const normalSizeInput = document.getElementById('normal-size');
            const footnoteSizeInput = document.getElementById('footnote-size');
            const autoSizeButton = document.getElementById('auto-size-button');
            
            // Margin slider
            const marginSlider = document.getElementById('margin-slider');
            const marginValue = document.getElementById('margin-value');
            
            // Sample buttons
            const basicShapesBtn = document.getElementById('basicShapes');
            const simpleChartBtn = document.getElementById('simpleChart');
            const flowchartBtn = document.getElementById('flowchart');
            const comparisonChartBtn = document.getElementById('comparisonChart');
            
            // Get resolution radio buttons and fit method radio buttons
            const resolutionRadios = document.querySelectorAll('input[name="resolution"]');
            const fitMethodRadios = document.querySelectorAll('input[name="fit-method"]');
            
            // Flag for library loaded status
            let pptxLibraryLoaded = false;
            
            // Current resolution dimensions (default 16:9)
            let currentResolution = {
                width: 1920,
                height: 1080
            };
            
            // Current settings
            let currentMargin = 0; // Default 0%
            let currentFontFamily = 'Arial'; // Default font family
            let currentFitMethod = 'fit'; // Default 'fit'
            
            // Sample SVGs
            const sampleSVGs = {
                'basicShapes': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300">
                    <rect x="50" y="50" width="100" height="100" fill="#4285f4" />
                    <circle cx="250" cy="100" r="50" fill="#ea4335" />
                    <polygon points="100,200 150,250 50,250" fill="#fbbc05" />
                    <ellipse cx="250" cy="225" rx="75" ry="50" fill="#34a853" />
                </svg>`,
                'simpleChart': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300">
                    <line x1="50" y1="250" x2="350" y2="250" stroke="black" stroke-width="2" />
                    <line x1="50" y1="250" x2="50" y2="50" stroke="black" stroke-width="2" />
                    <rect x="75" y="150" width="50" height="100" fill="#4285f4" />
                    <rect x="175" y="100" width="50" height="150" fill="#ea4335" />
                    <rect x="275" y="180" width="50" height="70" fill="#34a853" />
                    <text x="200" y="30" text-anchor="middle" font-family="Arial" font-size="16">Simple Bar Chart</text>
                    <text x="200" y="280" text-anchor="middle" font-family="Arial" font-size="14">Categories</text>
                    <text x="30" y="150" text-anchor="middle" transform="rotate(-90,30,150)" font-family="Arial" font-size="14">Values</text>
                </svg>`,
                'flowchart': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300">
                    <rect x="150" y="20" width="100" height="50" rx="10" fill="#e6f7ff" stroke="#1890ff" stroke-width="2" />
                    <text x="200" y="45" text-anchor="middle" font-family="Arial" font-size="14">Start</text>
                    
                    <rect x="150" y="120" width="100" height="50" rx="0" fill="#fff7e6" stroke="#fa8c16" stroke-width="2" />
                    <text x="200" y="145" text-anchor="middle" font-family="Arial" font-size="14">Process</text>
                    
                    <polygon points="200,220 240,250 200,280 160,250" fill="#f6ffed" stroke="#52c41a" stroke-width="2" />
                    <text x="200" y="255" text-anchor="middle" font-family="Arial" font-size="14">Decision</text>
                    
                    <line x1="200" y1="70" x2="200" y2="120" stroke="#666" stroke-width="2" />
                    <line x1="200" y1="170" x2="200" y2="220" stroke="#666" stroke-width="2" />
                    
                    <polygon points="195,80 200,100 205,80" fill="#666" />
                    <polygon points="195,190 200,210 205,190" fill="#666" />
                </svg>`,
                'comparisonChart': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
                    <rect width="800" height="600" fill="#f8f8f8"/>
                    
                    <!-- Title -->
                    <text x="400" y="60" text-anchor="middle" font-family="Arial" font-size="24" font-weight="bold">Key Findings: Entain vs. Competitors</text>
                    
                    <!-- Left Panel -->
                    <rect x="70" y="120" width="320" height="400" fill="#f0f7ff" rx="10" ry="10"/>
                    <text x="230" y="150" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">Current Assessment</text>
                    
                    <text x="80" y="190" font-family="Arial" font-size="14">Analysis of Coral mobile UI compared to top</text>
                    <text x="80" y="210" font-family="Arial" font-size="14">20 competitors shows</text>
                    <text x="220" y="250" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="#505050">no significant</text>
                    <text x="220" y="280" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="#505050">advantage in fairness perception</text>
                    
                    <rect x="90" y="320" width="280" height="130" fill="#e6f0ff" rx="5" ry="5"/>
                    <text x="230" y="350" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="#0066cc">Standout Feature</text>
                    <text x="100" y="380" font-family="Arial" font-size="14">"Tap field to see how/what to win"</text>
                    <text x="100" y="400" font-family="Arial" font-size="14">provides transparency that customers</text>
                    <text x="100" y="420" font-family="Arial" font-size="14">value, but is underutilized.</text>
                    
                    <!-- Right Panel - Opportunities -->
                    <rect x="410" y="120" width="320" height="180" fill="#fff8e6" rx="10" ry="10"/>
                    <text x="570" y="150" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">Priority Opportunities</text>
                    
                    <circle cx="430" cy="180" r="5" fill="#f57c00"/>
                    <text x="445" y="185" font-family="Arial" font-size="14">Highlight RTP and testing certifications</text>
                    <text x="445" y="205" font-family="Arial" font-size="14">more prominently</text>
                    
                    <circle cx="430" cy="235" r="5" fill="#f57c00"/>
                    <text x="445" y="240" font-family="Arial" font-size="14">Implement top competitor features:</text>
                    
                    <rect x="455" y="255" width="200" height="25" rx="12" ry="12" fill="#e0f2f1"/>
                    <text x="525" y="273" text-anchor="middle" font-family="Arial" font-size="14">Game history</text>
                    <text x="650" y="273" font-family="Arial" font-size="12">(15/20 rivals)</text>
                    
                    <!-- Research Next Steps -->
                    <rect x="410" y="315" width="320" height="205" fill="#e8f5e9" rx="10" ry="10"/>
                    <text x="570" y="345" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">Research Next Steps</text>
                    
                    <circle cx="430" cy="375" r="5" fill="#2e7d32"/>
                    <text x="445" y="380" font-family="Arial" font-size="14">Analyze demographics of players rating</text>
                    <text x="445" y="400" font-family="Arial" font-size="14">high NPS – identify potential brand</text>
                    <text x="445" y="420" font-family="Arial" font-size="14">loyalty effects</text>
                    
                    <circle cx="430" cy="450" r="5" fill="#2e7d32"/>
                    <text x="445" y="455" font-family="Arial" font-size="14">Measure usage metrics for "tap field to</text>
                    <text x="445" y="475" font-family="Arial" font-size="14">see how/what to win" feature</text>
                    
                    <!-- Page Number -->
                    <text x="770" y="580" text-anchor="end" font-family="Arial" font-size="12">4</text>
                    <text x="40" y="580" font-family="Arial" font-size="12">Competitive Intelligence Analysis</text>
                </svg>`
            };
            
            // Update margin display
            marginValue.textContent = currentMargin + '%';
            
            // Check if PptxGenJS is available
            function checkPptxLibrary() {
                setTimeout(function() {
                    if (typeof PptxGenJS !== 'undefined') {
                        pptxLibraryLoaded = true;
                        loadingIndicator.style.display = 'none';
                        libraryError.style.display = 'none';
                    } else {
                        // Try to load it from the alternative CDN
                        const script = document.createElement('script');
                        script.src = 'https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.bundle.js';
                        script.onload = function() {
                            pptxLibraryLoaded = true;
                            loadingIndicator.style.display = 'none';
                            libraryError.style.display = 'none';
                        };
                        script.onerror = function() {
                            // Both CDNs failed
                            pptxLibraryLoaded = false;
                            loadingIndicator.style.display = 'none';
                            libraryError.style.display = 'block';
                            
                            // Enable SVG download as fallback
                            downloadSvgButton.style.display = 'block';
                        };
                        document.head.appendChild(script);
                    }
                }, 1000); // Give the library a second to load
            }
            
            // Initialize PowerPoint library check
            checkPptxLibrary();
            
            // Setup resolution change handlers
            resolutionRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateResolution(this.value);
                });
            });
            
            // Update resolution based on selection
            function updateResolution(layout) {
                switch(layout) {
                    case 'LAYOUT_4x3':
                        currentResolution = { width: 1024, height: 768 };
                        break;
                    case 'LAYOUT_16x10':
                        currentResolution = { width: 1920, height: 1200 };
                        break;
                    case 'LAYOUT_16x9':
                    default:
                        currentResolution = { width: 1920, height: 1080 };
                        break;
                }
            }
            
            // Setup fit method change handlers
            fitMethodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    currentFitMethod = this.value;
                    updatePreview();
                });
            });
            
            // Update margin handler
            marginSlider.addEventListener('input', function() {
                currentMargin = parseInt(this.value);
                marginValue.textContent = currentMargin + '%';
                updatePreview();
            });
            
            // Update font family handler
            fontFamilySelect.addEventListener('change', function() {
                currentFontFamily = this.value;
                updatePreview();
            });
            
            // Font size inputs
            titleSizeInput.addEventListener('input', function() {
                updatePreview();
            });
            
            subheaderSizeInput.addEventListener('input', function() {
                updatePreview();
            });
            
            normalSizeInput.addEventListener('input', function() {
                updatePreview();
            });
            
            footnoteSizeInput.addEventListener('input', function() {
                updatePreview();
            });
            
            // Detect fonts from SVG
            detectFontsButton.addEventListener('click', function() {
                const svgCode = svgInput.value.trim();
                if (!svgCode || !svgCode.startsWith('<svg')) {
                    showStatus('Please enter valid SVG code first', 'warning');
                    return;
                }
                
                const detectedFonts = detectFontsFromSvg(svgCode);
                if (detectedFonts.length > 0) {
                    // Update font select box
                    const primaryFont = detectedFonts[0];
                    
                    // Check if font exists in the dropdown
                    let fontExists = false;
                    for (let i = 0; i < fontFamilySelect.options.length; i++) {
                        if (fontFamilySelect.options[i].value === primaryFont) {
                            fontFamilySelect.selectedIndex = i;
                            fontExists = true;
                            break;
                        }
                    }
                    
                    // If font doesn't exist in dropdown, add it
                    if (!fontExists) {
                        const option = document.createElement('option');
                        option.value = primaryFont;
                        option.text = primaryFont;
                        fontFamilySelect.add(option, 0);
                        fontFamilySelect.selectedIndex = 0;
                    }
                    
                    currentFontFamily = primaryFont;
                    showStatus(`Detected font: ${primaryFont}`, 'success');
                    
                    // Try auto-sizing as well
                    autoSizeText();
                } else {
                    showStatus('No fonts detected in the SVG', 'warning');
                }
            });
            
            // Auto-size text
            autoSizeButton.addEventListener('click', function() {
                autoSizeText();
            });
            
            function autoSizeText() {
                const svgCode = svgInput.value.trim();
                if (!svgCode || !svgCode.startsWith('<svg')) {
                    showStatus('Please enter valid SVG code first', 'warning');
                    return;
                }
                
                // Parse the SVG to find text elements
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgCode, 'image/svg+xml');
                const textElements = svgDoc.querySelectorAll('text');
                
                if (textElements.length === 0) {
                    showStatus('No text elements found in SVG', 'warning');
                    return;
                }
                
                // Collect all font sizes
                const fontSizes = [];
                textElements.forEach(text => {
                    const fontSize = text.getAttribute('font-size');
                    if (fontSize) {
                        // Extract numeric part
                        const size = parseFloat(fontSize);
                        if (!isNaN(size)) {
                            fontSizes.push({ 
                                size: size,
                                y: parseFloat(text.getAttribute('y') || 0),
                                text: text.textContent
                            });
                        }
                    }
                });
                
                if (fontSizes.length === 0) {
                    showStatus('Could not determine font sizes in SVG', 'warning');
                    return;
                }
                
                // Sort by size (descending)
                fontSizes.sort((a, b) => b.size - a.size);
                
                // Find title (usually largest font and often near the top)
                let titleSize = fontSizes[0].size;
                
                // Try to identify a title by position and size
                const viewBox = svgDoc.documentElement.getAttribute('viewBox');
                let svgHeight = 600; // Default if not specified
                
                if (viewBox) {
                    const parts = viewBox.split(' ');
                    if (parts.length >= 4) {
                        svgHeight = parseFloat(parts[3]);
                    }
                }
                
                // Title is usually in the top 15% of the SVG and is one of the largest fonts
                const topElements = fontSizes.filter(item => item.y < svgHeight * 0.15);
                if (topElements.length > 0) {
                    topElements.sort((a, b) => b.size - a.size);
                    titleSize = topElements[0].size;
                }
                
                // Calculate other sizes based on typical ratios
                // Title:Subheader:Normal:Footnote ratios are roughly 2:1.5:1:0.85
                const normalTextSize = Math.round(fontSizes[Math.floor(fontSizes.length / 2)].size);
                const subheaderSize = Math.round(normalTextSize * 1.5);
                const footnoteSize = Math.round(normalTextSize * 0.85);
                
                // Update the inputs
                titleSizeInput.value = Math.max(Math.min(Math.round(titleSize), 72), 8);
                subheaderSizeInput.value = Math.max(Math.min(subheaderSize, 72), 8);
                normalSizeInput.value = Math.max(Math.min(normalTextSize, 72), 8);
                footnoteSizeInput.value = Math.max(Math.min(footnoteSize, 72), 8);
                
                showStatus('Text sizes auto-detected', 'success');
                updatePreview();
            }
            
            // Function to detect fonts used in SVG
            function detectFontsFromSvg(svgCode) {
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgCode, 'image/svg+xml');
                const textElements = svgDoc.querySelectorAll('text');
                
                const fonts = new Set();
                textElements.forEach(text => {
                    const fontFamily = text.getAttribute('font-family');
                    if (fontFamily) {
                        // Handle comma-separated font lists
                        const fontList = fontFamily.split(',');
                        const primaryFont = fontList[0].trim().replace(/["']/g, ''); // Remove quotes
                        fonts.add(primaryFont);
                    }
                });
                
                return Array.from(fonts);
            }
            
            // Sample SVG buttons
            basicShapesBtn.addEventListener('click', function() {
                svgInput.value = sampleSVGs.basicShapes;
            });
            
            simpleChartBtn.addEventListener('click', function() {
                svgInput.value = sampleSVGs.simpleChart;
            });
            
            flowchartBtn.addEventListener('click', function() {
                svgInput.value = sampleSVGs.flowchart;
            });
            
            comparisonChartBtn.addEventListener('click', function() {
                svgInput.value = sampleSVGs.comparisonChart;
            });
            
            // Update preview when SVG input changes
            svgInput.addEventListener('input', function() {
                if (document.getElementById('preview-tab').classList.contains('active')) {
                    updatePreview();
                }
            });
            
            function updatePreview() {
                const svgCode = svgInput.value.trim();
                
                // Calculate preview dimensions to maintain aspect ratio
                const previewWidth = document.getElementById('preview-container').clientWidth - 20; // Accounting for padding
                const aspectRatio = currentResolution.height / currentResolution.width;
                const previewHeight = previewWidth * aspectRatio;
                
                // Set the preview frame dimensions
                previewFrame.style.width = previewWidth + 'px';
                previewFrame.style.height = previewHeight + 'px';
                
                if (svgCode && svgCode.startsWith('<svg')) {
                    try {
                        // Basic sanitization
                        const sanitizedSVG = svgCode
                            .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                            .replace(/on\w+="[^"]*"/g, '')
                            .replace(/on\w+='[^']*'/g, '');
                        
                        // Parse SVG to modify it
                        const parser = new DOMParser();
                        const svgDoc = parser.parseFromString(sanitizedSVG, 'image/svg+xml');
                        const svgElement = svgDoc.documentElement;
                        
                        if (svgElement) {
                            // Apply font family to all text elements
                            const textElements = svgElement.querySelectorAll('text');
                            textElements.forEach(text => {
                                text.setAttribute('font-family', currentFontFamily);
                            });
                            
                            // Apply font sizes based on categories
                            const titleSize = parseInt(titleSizeInput.value);
                            const subheaderSize = parseInt(subheaderSizeInput.value);
                            const normalSize = parseInt(normalSizeInput.value);
                            const footnoteSize = parseInt(footnoteSizeInput.value);
                            
                            // Get SVG dimensions for text categorization
                            const viewBox = svgElement.getAttribute('viewBox');
                            let svgHeight = 600; // Default if not specified
                            
                            if (viewBox) {
                                const parts = viewBox.split(' ');
                                if (parts.length >= 4) {
                                    svgHeight = parseFloat(parts[3]);
                                }
                            }
                            
                            // Apply text sizes based on position and attributes
                            textElements.forEach(text => {
                                const y = parseFloat(text.getAttribute('y') || 0);
                                const fontWeight = text.getAttribute('font-weight');
                                const textContent = text.textContent.trim();
                                const textLength = textContent.length;
                                
                                // Categorize by position, attributes, and length
                                if (y < svgHeight * 0.15 && (fontWeight === 'bold' || textLength < 50)) {
                                    // Likely a title
                                    text.setAttribute('font-size', titleSize);
                                } else if ((fontWeight === 'bold' || textContent.toUpperCase() === textContent) && textLength < 80) {
                                    // Likely a subheader
                                    text.setAttribute('font-size', subheaderSize);
                                } else if (textLength < 15 && y > svgHeight * 0.85) {
                                    // Likely a footnote or page number
                                    text.setAttribute('font-size', footnoteSize);
                                } else {
                                    // Normal text
                                    text.setAttribute('font-size', normalSize);
                                }
                            });
                            
                            // Serialize back to string
                            const serializer = new XMLSerializer();
                            const modifiedSVG = serializer.serializeToString(svgElement);
                            
                            svgPreview.innerHTML = modifiedSVG;
                            
                            // Make SVG responsive and apply margin
                            const svg = svgPreview.querySelector('svg');
                            if (svg) {
                                // Calculate margined dimensions
                                const marginFactor = currentMargin / 100;
                                const marginedWidth = previewWidth * (1 - 2 * marginFactor);
                                const marginedHeight = previewHeight * (1 - 2 * marginFactor);
                                
                                // Center SVG and apply margin
                                svg.style.position = 'absolute';
                                svg.style.top = (previewHeight * marginFactor) + 'px';
                                svg.style.left = (previewWidth * marginFactor) + 'px';
                                svg.style.width = marginedWidth + 'px';
                                svg.style.height = marginedHeight + 'px';
                                
                                // Apply different fit methods
                                switch (currentFitMethod) {
                                    case 'fill':
                                        svg.setAttribute('preserveAspectRatio', 'xMidYMid slice');
                                        break;
                                    case 'stretch':
                                        svg.setAttribute('preserveAspectRatio', 'none');
                                        break;
                                    case 'fit':
                                    default:
                                        svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
                                        break;
                                }
                            }
                        } else {
                            svgPreview.innerHTML = `<p style="color: red;">Could not parse SVG properly</p>`;
                        }
                    } catch (error) {
                        svgPreview.innerHTML = `<p style="color: red;">Error previewing SVG: ${error.message}</p>`;
                    }
                } else {
                    svgPreview.innerHTML = '<p style="text-align: center; color: #999; padding-top: ' + (previewHeight/2-10) + 'px;">SVG preview will appear here</p>';
                }
            }
            
            // Function to get the current modified SVG
            function getModifiedSvg() {
                const svgCode = svgInput.value.trim();
                if (!svgCode || !svgCode.startsWith('<svg')) {
                    showStatus('Please enter valid SVG code', 'error');
                    return null;
                }
                
                try {
                    // Basic sanitization
                    const sanitizedSVG = svgCode
                        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                        .replace(/on\w+="[^"]*"/g, '')
                        .replace(/on\w+='[^']*'/g, '');
                    
                    // Parse SVG to modify it
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(sanitizedSVG, 'image/svg+xml');
                    const svgElement = svgDoc.documentElement;
                    
                    if (!svgElement) {
                        showStatus('Invalid SVG structure detected', 'error');
                        return null;
                    }
                    
                    // Apply font family to all text elements
                    const textElements = svgElement.querySelectorAll('text');
                    textElements.forEach(text => {
                        text.setAttribute('font-family', currentFontFamily);
                    });
                    
                    // Apply font sizes based on categories
                    const titleSize = parseInt(titleSizeInput.value);
                    const subheaderSize = parseInt(subheaderSizeInput.value);
                    const normalSize = parseInt(normalSizeInput.value);
                    const footnoteSize = parseInt(footnoteSizeInput.value);
                    
                    // Get SVG dimensions for text categorization
                    const viewBox = svgElement.getAttribute('viewBox');
                    let svgHeight = 600; // Default if not specified
                    
                    if (viewBox) {
                        const parts = viewBox.split(' ');
                        if (parts.length >= 4) {
                            svgHeight = parseFloat(parts[3]);
                        }
                    }
                    
                    // Apply text sizes based on position and attributes
                    textElements.forEach(text => {
                        const y = parseFloat(text.getAttribute('y') || 0);
                        const fontWeight = text.getAttribute('font-weight');
                        const textContent = text.textContent.trim();
                        const textLength = textContent.length;
                        
                        // Categorize by position, attributes, and length
                        if (y < svgHeight * 0.15 && (fontWeight === 'bold' || textLength < 50)) {
                            // Likely a title
                            text.setAttribute('font-size', titleSize);
                        } else if ((fontWeight === 'bold' || textContent.toUpperCase() === textContent) && textLength < 80) {
                            // Likely a subheader
                            text.setAttribute('font-size', subheaderSize);
                        } else if (textLength < 15 && y > svgHeight * 0.85) {
                            // Likely a footnote or page number
                            text.setAttribute('font-size', footnoteSize);
                        } else {
                            // Normal text
                            text.setAttribute('font-size', normalSize);
                        }
                    });
                    
                    // Serialize back to string
                    const serializer = new XMLSerializer();
                    return serializer.serializeToString(svgElement);
                    
                } catch (error) {
                    showStatus('Error processing SVG: ' + error.message, 'error');
                    return null;
                }
            }
            
            // Download SVG button handler (fallback when PowerPoint library isn't available)
            downloadSvgButton.addEventListener('click', function() {
                const modifiedSvg = getModifiedSvg();
                if (!modifiedSvg) return;
                
                // Create a download link
                const blob = new Blob([modifiedSvg], {type: 'image/svg+xml'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'modified-svg.svg';
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 0);
                
                showStatus('SVG downloaded successfully!', 'success');
            });
            
            // Convert SVG to PowerPoint
            convertButton.addEventListener('click', function() {
                if (!pptxLibraryLoaded) {
                    showStatus('PowerPoint library is not available. You can download the SVG instead.', 'warning');
                    downloadSvgButton.style.display = 'block';
                    return;
                }
                
                const modifiedSvg = getModifiedSvg();
                if (!modifiedSvg) return;
                
                showStatus('Converting... Please wait', 'warning');
                
                // Get selected resolution
                let selectedLayout = document.querySelector('input[name="resolution"]:checked').value;
                
                try {
                    // Create a new instance of PptxGenJS
                    let pptx = new PptxGenJS();
                    
                    // Set slide layout
                    try {
                        pptx.layout = selectedLayout;
                    } catch (e) {
                        // Continue anyway with default layout
                        console.warn('Could not set layout:', e);
                    }
                    
                    // Add a slide
                    const slide = pptx.addSlide();
                    
                    // Convert SVG to base64
                    const svgBlob = new Blob([modifiedSvg], {type: 'image/svg+xml'});
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const svgBase64 = e.target.result;
                        
                        // Calculate margin in PowerPoint units (0-100%)
                        const marginPercent = currentMargin / 100;
                        
                        // Add SVG to slide with proper margin
                        try {
                            // Different sizing options based on the fit method
                            let sizing = {};
                            switch (currentFitMethod) {
                                case 'fill':
                                    sizing = { type: 'cover', w: `${(1 - 2 * marginPercent) * 100}%`, h: `${(1 - 2 * marginPercent) * 100}%` };
                                    break;
                                case 'stretch':
                                    sizing = { type: 'contain', w: `${(1 - 2 * marginPercent) * 100}%`, h: `${(1 - 2 * marginPercent) * 100}%` };
                                    break;
                                case 'fit':
                                default:
                                    sizing = { type: 'contain', w: `${(1 - 2 * marginPercent) * 100}%`, h: `${(1 - 2 * marginPercent) * 100}%` };
                                    break;
                            }
                            
                            slide.addImage({
                                data: svgBase64,
                                x: `${marginPercent * 100}%`,
                                y: `${marginPercent * 100}%`,
                                w: `${(1 - 2 * marginPercent) * 100}%`,
                                h: `${(1 - 2 * marginPercent) * 100}%`,
                                sizing: sizing
                            });
                            
                            // Save the PowerPoint file
                            pptx.writeFile({ fileName: 'svg-slide.pptx' })
                                .then(function() {
                                    showStatus('PowerPoint file created successfully!', 'success');
                                })
                                .catch(function(error) {
                                    showStatus('Error creating PowerPoint file: ' + error.message, 'error');
                                    // Show SVG download as fallback
                                    downloadSvgButton.style.display = 'block';
                                });
                        } catch (err) {
                            showStatus('Error adding image to slide: ' + err.message, 'error');
                            // Show SVG download as fallback
                            downloadSvgButton.style.display = 'block';
                        }
                    };
                    
                    reader.onerror = function() {
                        showStatus('Error reading SVG data', 'error');
                        // Show SVG download as fallback
                        downloadSvgButton.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(svgBlob);
                    
                } catch (error) {
                    showStatus('PowerPoint generation error: ' + error.message, 'error');
                    console.error('Detailed error:', error);
                    // Show SVG download as fallback
                    downloadSvgButton.style.display = 'block';
                }
            });
            
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status ' + type;
                statusMessage.style.display = 'block';
                
                // Hide success/warning messages after 8 seconds, keep errors visible
                if (type !== 'error') {
                    setTimeout(function() {
                        statusMessage.style.display = 'none';
                    }, 8000);
                }
            }
            
            // Initialize with default sample SVG
            if (!svgInput.value) {
                svgInput.value = sampleSVGs.comparisonChart;
            }
            
            // Initialize preview size on window resize
            window.addEventListener('resize', function() {
                if (document.getElementById('preview-tab').classList.contains('active')) {
                    updatePreview();
                }
            });
        });
    </script>
</body>
</html>
